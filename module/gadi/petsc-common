if { [ info exists env(FIREDRAKE_USE_BUILD_OVERRIDE) ] } {
    set use_build $::env(FIREDRAKE_USE_BUILD_OVERRIDE)
} elseif { [ info exists env(PBS_ENVIRONMENT) ] } {
    set use_build ""
} else {
    set use_build "-inplace"
}

if { $use_build eq "" } {
    prepend-path CONTAINER_OVERLAY_PATH $prefix/$tag$version_tag.tar
}

setenv PETSC_DIR $prefix$use_build/$tag
setenv PETSC_ARCH default

### Make PyOP2 build optimised kernels
setenv PYOP2_LDFLAGS "-shared"
setenv PYOP2_CFLAGS "$pyop2_compiler_opt_flags -std=gnu11"
setenv PYOP2_CXXFLAGS "$pyop2_compiler_opt_flags"
setenv PYOP2_CC mpicc
setenv PYOP2_CXX mpicxx